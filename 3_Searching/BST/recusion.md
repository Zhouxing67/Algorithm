

# BST 与 递归

递归是一些高效算法得以实现的基础，是分而治之思想的具体实现，正确写出和真正理解的递归程序能提高我们的代码能力，从而解决更多问题

### 正确性

递归的数学基础是[数学归纳法](https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6%E5%BD%92%E7%BA%B3%E6%B3%95/5155524)， 也可参见：[Here](https://cs.nju.edu.cn/zhangl/cpl/note06.pdf)

### 三要素

在平时coding的过程中：写好一个递归函数通常关注以下三点：

- 返回值：是否需要返回值，返回值所表示的意义
- 参数：递归函数调用一次的参数
- 终止条件：递归调用返回的条件

### 理解递归

==**理解递归程序不能采用常规的思路单步调试程序，而更应该关注语义，即要知道函数做了什么事情**==

下面将以BST的插入更新操作为例来分析一段递归代码

```C++
Node* update(Node* node, K key, V val)
        {
            if (node == nullptr)
                return new Node(key, val);
            if (node->key_ == key)
                node->val_ = val;
            else if (comparef(key, node->key_))
                node->left_ = update(node->left_, key, val);
            else
                node->right_ = update(node->right_, key, val);
            node->N = size(node->left_) + size(node->right_) + 1;
            return node;
        }
```

update 函数是实现二叉搜索树的更新与插入功能的核心代码。分析语义：update 会遍历以node为根节点的二叉搜索树，找到key所在的位置，插入key或者使用 val 来更新key的值，函数会被如下的方式调用：

```c++
root_ = update(root_, key, val);
```

理解这段代码的难点在于这段代码的返回值，update的返回值有两种情况：

1. 若当前访问的节点为空， 则返回一个新的节点（使用key 和 value 初始化）
2. 否则返回参数节点node

有三处使用了update函数的返回值 

```C++
 root_ = update(root_, key, val);
 node->left_ = update(node->left_, key, val);
 node->right_ = update(node->right_, key, val);
```

结合返回值的两种返回情况，以及update的调用场景，我们可以这样看待update返回Node*的目的

1. **递归调用：** 在每一次递归调用中，它会返回一个更新后的节点指针。这个节点指针可能是新创建的节点，也可能是原有节点经过值更新后的结果。
2. **连接子树：** 当递归调用返回时，当前节点的左右子树可能已经被更新了。为了保持整个树结构的完整性，当前节点需要将更新后的左右子树连接上去。所以需要返回更新后的当前节点，以便上层递归调用正确地连接子树。
3. **更新根节点：** 在递归调用的最外层，即在树的根节点处，调用 *<font color=redblack> update</font>* 函数。因为整个树可能会发生变化，需要确保根节点的指针正确指向更新后的树。所以通过返回更新后的根节点，可以确保树的根节点指针得到正确更新。

注意到, 大多数情况，作为参数的节点node是被直接返回的，也就是说如果绝大多数情况下 : *node = update(node, ...)*的作用 可以理解为 *node = node*。

### 返回值

递归函数需要返回值的情况通常包括以下几种：

1. **递归求解问题：** 当递归函数用于解决一个问题时，通常需要将部分计算的结果传递给上一级递归调用或最终返回给调用者。这些结果可能是中间计算结果，也可能是最终解。
2. **状态更新：** 在递归过程中，函数可能会修改状态或数据结构，如更新树节点的值、修改数组或链表等。此时需要返回更新后的状态或数据结构，以便在递归调用的过程中正确地传递和维护状态。
3. **返回递归计算结果：** 当递归函数用于计算某个结果时，通常需要将最终的计算结果返回给调用者。例如，递归函数用于计算斐波那契数列、阶乘、或者搜索树中某个节点的值等情况。
4. **维护递归调用栈：** 在递归函数中，每次递归调用都会在调用栈中创建一个新的函数调用帧。如果需要在递归调用之间传递信息或者维护状态，可能需要使用返回值将信息传递给上一级调用，或者将状态更新后的值返回给调用者。

